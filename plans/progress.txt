## 2026-01-12 - chore-001
- Created packages/cli directory structure
- Added package.json with name "ralphban", bin field, private: false
- Added tsconfig.json matching server package pattern
- Created placeholder cli.ts entry point
- Updated eslint.config.js to include CLI package in node globals
- **Learnings:**
  - ESLint config at root needs explicit file patterns for new packages
  - Placeholder entry point needed for typecheck to pass on new package
---

## 2026-01-12 - chore-002
- Created packages/mcp-cli directory structure
- Added package.json with name "ralphban-mcp", bin field, private: false
- Added yargs dependency for CLI argument parsing
- Added tsconfig.json matching cli package pattern
- Created placeholder mcp-cli.ts entry point
- Updated eslint.config.js to include mcp-cli package in node globals
- **Learnings:**
  - Followed same pattern as chore-001 for consistency
  - yargs v18 used for modern ESM CLI parsing
---

## 2026-01-12 - feat-001
- Created packages/server/src/utils/git-validation.ts
- Implemented checkIsGitRepo using git rev-parse --git-dir
- Implemented checkIsCleanWorkingTree using git status --porcelain
- Exported validateGitRepository function combining both checks
- Returns GitValidationResult with valid boolean and errors array
- **Learnings:**
  - Used spawn from child_process directly for simpler git commands
  - Existing spawnProcess utility has logging that's not needed for validation
  - All functions accept optional cwd parameter for flexibility
---

## 2026-01-12 - feat-002
- Implemented main CLI entry point in packages/cli/src/cli.ts
- Added git validation before initialization
- Added DATABASE_URL env validation with helpful error
- Integrated tRPC handler and Ralph endpoint from server package
- Added static file serving from web-dist folder
- Added SPA fallback routing
- Added exports to @ralphban/server package.json for subpath imports
- **Learnings:**
  - Server package needed exports field to expose subpaths
  - Using .ts extensions in exports works with tsx for dev
  - web-dist path is relative to cli.ts location using __dirname
---

## 2026-01-12 - feat-003
- Implemented MCP CLI entry point in packages/mcp-cli/src/mcp-cli.ts
- Added yargs parsing for --cwd argument with demandOption
- Added absolute path validation for --cwd
- Added git validation on target directory
- Added DATABASE_URL env validation
- Changes process.cwd() to target directory before MCP init
- Initializes db pool and MCP server with stdio transport
- Added @modelcontextprotocol/sdk dependency to mcp-cli package
- Added ./mcp/server export to @ralphban/server package
- **Learnings:**
  - yargs hideBin helper strips node/tsx prefix from argv
  - MCP server creation reuses existing createMCPServer from server pkg
  - Server package exports need updating for each new subpath import
---

## 2026-01-12 - chore-003
- Added explicit build config to packages/web/vite.config.ts
- Set base: '/' for absolute asset paths (compatible with Express static)
- Set outDir: 'dist' and assetsDir: 'assets' explicitly
- Verified build outputs index.html and assets/index-*.js correctly
- **Learnings:**
  - Vite default base '/' produces absolute paths like /assets/index.js
  - Express.static serves these correctly when mounted at root
  - Explicit config documents intent even when matching defaults
---

## 2026-01-12 - chore-004
- Updated packages/server/src/ralph/service.ts MCP_CONFIG generation
- Changed from static const to buildMcpConfig function accepting workingDirectory
- Changed command from 'pnpm' to 'npx'
- Changed args from ['--filter', 'server', 'mcp:stdio'] to ['ralphban-mcp', '--cwd', workingDirectory]
- **Learnings:**
  - Integration test ralph-loop.test.ts times out because npx ralphban-mcp isn't published yet
  - Test designed for old pnpm workspace setup needs future update when packages are published
  - Linter auto-adds .js extension to imports for ESM compatibility
---

## 2026-01-12 - chore-005
- Updated @ralphban/api package.json with description, license, and repository fields
- Updated @ralphban/server package.json with description, license, and repository fields
- Verified builds complete successfully
- Verified npm pack --dry-run shows only dist files in tarball
- **Learnings:**
  - "files" field in package.json restricts what npm publish includes
  - Both packages already had private: false and exports configured correctly
---

## 2026-01-12 - chore-006
- Verified tsconfig already properly configured for both CLI packages (ES2022, ESNext module)
- Confirmed tsc preserves shebang lines in output
- Added chmod +x to build scripts in both packages/cli and packages/mcp-cli
- Tested direct execution of built CLIs successfully
- Verified imports to @ralphban/server subpaths resolve correctly
- **Learnings:**
  - TypeScript 5.9 preserves shebang comments automatically
  - moduleResolution: "bundler" works well for workspace dependencies
  - Build script can chain chmod with && for simple postbuild steps
---

## 2026-01-12 - chore-007
- Created .env.example files for packages/cli and packages/mcp-cli
- Added ANTHROPIC_API_KEY validation to both CLI entry points
- Added helpful error message with console.anthropic.com link
- dotenv/config already imported at top of both files from previous work
- **Learnings:**
  - ANTHROPIC_API_KEY used implicitly by spawned `claude` CLI in ralph service
  - Both CLIs already had DATABASE_URL validation with helpful messages
  - Integration test failure is pre-existing (npx ralphban-mcp not published)
---

## 2026-01-12 - chore-008
- Added build scripts to root package.json for all packages
- Added build:api, build:server, build:web, build:cli, build:mcp individual scripts
- Added build:all script that chains builds in correct dependency order (api → server → web → cli → mcp)
- Added CLI packages (ralphban, ralphban-mcp) to typecheck and lint commands
- **Learnings:**
  - Dependency order: api first (no deps), then server (needs api), then web/cli/mcp in parallel theoretically but sequential in build:all is safer
  - CLI packages use package name (ralphban, ralphban-mcp) not @ralphban/cli
  - Integration test still fails due to unpublished npx (pre-existing, chore-011 will fix)
---

## 2026-01-12 - chore-011
- Modified buildMcpConfig() to check RALPHBAN_MCP_PATH env var
- If set: uses `node` with that path; if not: uses `npx ralphban-mcp`
- Removed unused path/dirname imports from service.ts
- Updated scripts/tests.sh to build mcp-cli before tests
- Set RALPHBAN_MCP_PATH env var when starting server in tests
- **Learnings:**
  - Integration tests now pass using local mcp-cli dist
  - Environment variable override pattern enables local dev without npm publish
  - Cleanup of unused imports simplifies codebase
---

## 2026-01-12 - chore-009
- Added prebuild script to CLI package that builds web and copies dist to web-dist
- Added files field to package.json with ["dist", "web-dist"]
- CLI already served from web-dist path (from feat-002)
- Added web-dist to eslint and prettier ignores (bundled JS was failing lint)
- Verified npm pack includes dist/cli.js and web-dist/ (4 files, 86.7KB)
- **Learnings:**
  - Bundled web assets must be excluded from linting/formatting
  - prebuild script auto-runs before build in pnpm
  - npm pack --dry-run useful for verifying tarball contents before publish
---

## 2026-01-12 - chore-012
- Created packages/server/src/server.ts with createServer function
- Moved Express app setup, trpc handler, ralph endpoint, error handler to server.ts
- Added ServerConfig interface with optional port and staticDir
- Updated packages/server/src/index.ts to import and call createServer
- Added root export "." to server package.json pointing to server.ts
- Updated CLI to use createServer with staticDir option
- CLI code reduced from 82 lines to 38 lines
- **Learnings:**
  - Server package exports need .d.ts files to exist for typecheck
  - Must run build:server before typecheck when adding new exports
  - createServer accepts staticDir for SPA serving (CLI uses, server doesn't)
---

## 2026-01-12 - feat-004
- Created packages/server/src/db/init.ts with initializeSchema function
- Uses CREATE TABLE/INDEX IF NOT EXISTS for idempotent schema creation
- Added checkTablesExist helper using information_schema query
- Catches ECONNREFUSED errors with helpful PostgreSQL message
- Added ./db/init export to server package.json
- Updated CLI to call initializeSchema after env validation
- **Learnings:**
  - IF NOT EXISTS makes schema idempotent without dropping existing data
  - Server package must be built before CLI typecheck to generate .d.ts
  - Pool.end() must be called after initialization to avoid hanging connections
---
