## 2026-01-09 - CHORE-001
- Created `packages/server/src/ralph/` module
- Added `ralph.sh` script that takes working directory and prompt as args
- Script cd's to working dir before invoking claude
- Files changed: `packages/server/src/ralph/ralph.sh`
- **Learnings:**
  - Existing `plans/ralph.sh` reads prompt from file, new script takes it as argument
  - Script outputs claude result and checks for `<promise>COMPLETE</promise>` marker
---

## 2026-01-09 - CHORE-002
- Created ralph service for spawning and managing ralph.sh process
- Files changed: `packages/server/src/ralph/service.ts`
- **Learnings:**
  - Used ES module `import.meta.url` pattern with `fileURLToPath` to resolve `__dirname`
  - Service returns `RalphResult` with output, isComplete flag, and exitCode
  - AbortSignal support for external cancellation via SIGTERM
  - Process errors and non-zero exits are rejected, except when COMPLETE marker found
---

## 2026-01-09 - CHORE-003
- Created integration test for ralph loop
- Files changed: `packages/integration-tests/tests/ralph-loop.test.ts`, `packages/integration-tests/package.json`, `.gitignore`
- **Learnings:**
  - Test imports service from @ralphban/server workspace package
  - Test working dir `.ralph-test-workdir` is purged with `rm -rf` in beforeEach
  - 120s timeout required for claude CLI invocation
  - Test verifies both `isComplete` flag and actual file content
---

## 2026-01-09 - CHORE-004
- Created `packages/server/src/utils/process.ts` with generic `spawnProcess` function
- Refactored `packages/server/src/ralph/service.ts` to use the new util
- Files changed: `packages/server/src/utils/process.ts`, `packages/server/src/ralph/service.ts`
- **Learnings:**
  - Generic spawnProcess returns `SpawnResult` with stdout, stderr, exitCode
  - Supports callbacks for stdout/stderr streaming and AbortSignal for cancellation
  - Service now uses async/await instead of manual Promise construction
  - Error message translation needed (Process aborted -> Ralph loop aborted) for API consistency
---

## 2026-01-09 - BUG-001
- Simplified `spawnProcess` to return only stdout string and throw on non-zero exit
- Removed COMPLETE marker check from ralph service (handled in ralph.sh)
- Simplified service to just run, log and catch errors
- Updated integration test to match new return type
- Files changed: `packages/server/src/utils/process.ts`, `packages/server/src/ralph/service.ts`, `packages/integration-tests/tests/ralph-loop.test.ts`
- **Learnings:**
  - stderr can be silently ignored when stdout is all we need
  - Throwing on non-zero exit simplifies caller code significantly
  - Service no longer needs RalphResult interface, just returns string
---

## 2026-01-09 - FEAT-001
- Created RALPH_PROMPT_TEMPLATE in service with instructions for tool-based workflow
- Removed prompt parameter from runRalphLoop function
- Added buildPrompt helper function
- Updated integration test to use new signature (skipped, will be fixed in next stage)
- Files changed: `packages/server/src/ralph/service.ts`, `packages/integration-tests/tests/ralph-loop.test.ts`
- **Learnings:**
  - Prompt template uses getTasks and markTaskComplete tool calls instead of direct file manipulation
  - Skipping PRD/progress reading since MCP will provide that context later
  - Test simplified since we can't test raw prompt anymore
---

## 2026-01-09 - CHORE-005
- Created POST /ralph endpoint in server that accepts workingDirectory in body
- Refactored integration test to call API instead of importing service directly
- Removed @ralphban/server dependency from integration-tests package
- Files changed: `packages/server/src/index.ts`, `packages/integration-tests/tests/ralph-loop.test.ts`, `packages/integration-tests/package.json`
- **Learnings:**
  - Using environment variable RALPH_API_URL for configurable endpoint (defaults to localhost:3001)
  - Test script already handles server lifecycle so tests are truly decoupled
  - Need to cast response.json() for TypeScript when accessing properties
---
