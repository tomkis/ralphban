## 2026-01-12 - chore-001
- Created unified entry point in server package
- Files changed:
  - packages/server/src/index.ts (replaced with yargs-based arg parser)
  - packages/server/src/cli.ts (new, HTTP server mode)
  - packages/server/src/mcp-cli.ts (new, MCP server mode)
  - packages/server/package.json (added yargs dependency)
- **Learnings:**
  - Dynamic imports used for lazy loading mode-specific code
  - Signal handlers registered in mode modules, not entry point
  - yargs hideBin helper strips node/script args from argv
---

## 2026-01-12 - chore-002
- Updated server package.json for npx publishing
- Files changed:
  - packages/server/package.json (added bin, prebuild, updated build)
- **Learnings:**
  - private:false and yargs were already added in chore-001
  - prebuild copies web/dist to web-dist before tsc runs
  - chmod +x ensures bin works without explicit node call
  - files array needs web-dist to include static assets in npm package
---

## 2026-01-12 - chore-003
- Updated root package.json bin entry and scripts
- Files changed:
  - package.json (added bin, removed cli/mcp from scripts)
  - scripts/tests.sh (build server instead of mcp-cli, use SKIP_GIT_VALIDATION/SKIP_API_KEY_CHECK)
  - packages/server/src/ralph/service.ts (use --mcp flag in MCP config)
  - packages/server/src/cli.ts (add SKIP_GIT_VALIDATION/SKIP_API_KEY_CHECK env vars)
  - packages/server/src/server.ts (fix Express 5 wildcard route syntax)
- **Learnings:**
  - Express 5 requires `{*path}` instead of `*` for wildcard routes
  - Test script needs env vars to bypass validations that block dev workflow
  - MCP invocation needs --mcp flag now that server handles both modes
  - build:all order matters: api -> web -> server (server prebuild copies web dist)
---

## 2026-01-12 - chore-004
- Removed redundant packages/cli directory
- Files changed:
  - packages/cli (deleted entirely)
- **Learnings:**
  - CLI functionality already moved to server package in chore-001
  - No code changes needed, simple directory removal
  - pnpm workspace auto-updates when package dir removed
---

## 2026-01-12 - chore-005
- Removed redundant packages/mcp-cli directory
- Files changed:
  - packages/mcp-cli (deleted entirely)
- **Learnings:**
  - MCP CLI functionality already moved to server package in chore-001
  - Same pattern as chore-004, simple directory removal
  - Tests still pass after removal
---

## 2026-01-12 - chore-006
- Verified HTTP server mode works correctly
- Tests performed:
  - Built server package with pnpm build:all
  - Ran without flags, verified DATABASE_URL validation
  - Ran without ANTHROPIC_API_KEY, verified API key check
  - Ran outside git repo, verified git validation fails
  - Started server with proper env vars on port 3001
  - Verified static web serving returns index.html
  - Verified tRPC endpoint responds at /trpc
  - Verified graceful SIGINT shutdown with "Shutdown complete" message
- **Learnings:**
  - Server defaults to port 3001 not 3000
  - All validation checks (git, db, api key) work correctly
  - Graceful shutdown properly closes server and db pool
  - No code changes needed, all functionality works as expected
---

## 2026-01-12 - chore-007
- Verified MCP server mode works correctly
- Tests performed:
  - Built server package with pnpm build:all
  - Ran with --mcp flag via stdio pipe
  - Sent MCP initialize request, received valid serverInfo response
  - Sent tools/list request, confirmed both tools registered (get_tasks_ready_for_implementation, mark_task_done)
  - Tested SIGINT graceful shutdown, confirmed "Shutdown complete" message
- **Learnings:**
  - MCP stdio server exits when stdin closes (expected behavior)
  - DB client connects silently on startup (no explicit log)
  - All verification steps pass without code changes
---
